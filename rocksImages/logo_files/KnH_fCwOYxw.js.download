;/*FB_PKG_DELIM*/

__d("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure",["LSLocalApplyOptimisticMessageWithAttachmentsV2","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.senderId;d[1]=b.threadKey;d[2]=b.threadType;d[3]=b.text;d[4]=b.snippet;d[5]=b.extraSendMessageParams;return c("LSLocalApplyOptimisticMessageWithAttachmentsV2").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSOptimisticContributeToTextPromptStoredProcedure",["LSOptimisticContributeToTextPrompt","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.senderId;d[2]=b.promptId;d[3]=b.productAttribution;d[4]=b.text;return c("LSOptimisticContributeToTextPrompt").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSOptimisticCreateRollCallStoredProcedure",["LSOptimisticCreateRollCall","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.threadKey;d[1]=b.prompt;d[2]=b.promptType;return c("LSOptimisticCreateRollCall").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("RollCallContributionType",[],(function(a,b,c,d,e,f){a=Object.freeze({MEDIA:0,TEXT:1,LINK:2});f["default"]=a}),66);
__d("RollCallPromptType",[],(function(a,b,c,d,e,f){a=Object.freeze({MEDIA:0,TEXT:1,LINK:2});f["default"]=a}),66);
__d("MWPromptCreationUtils",["I64","LSAuthorityLevel","LSFactory","LSIntEnum","LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure","LSMessagingThreadAttributionType","LSOptimisticContributeToTextPromptStoredProcedure","LSOptimisticCreateRollCallStoredProcedure","LSShape","LSVec","MWXMAAttachmentSharedStackConstants","MessagingAttachmentType","OfflineThreadingId","Promise","ReQL","RollCallContributionType","RollCallPromptType","XComposerPhotoUploader"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e,f,g){return new(j||(j=b("Promise")))(function(b,j){a.runInTransaction(function(a){return c("LSOptimisticCreateRollCallStoredProcedure")(c("LSFactory")(a),{prompt:f,promptType:(h||(h=d("LSIntEnum"))).ofNumber(g),threadKey:e})},"readwrite").then(function(e){var f=e[0],g=d("ReQL").fromTableAscending(a.tables.roll_calls).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.offlineThreadingId;var h=(i||(i=d("I64"))).to_int32(e.value.authorityLevel)>=c("LSAuthorityLevel").AUTHORITATIVE;h&&a!=null&&(i||(i=d("I64"))).equal(a,f)&&(g(),b(e.value.rollCallId))}})})["catch"](function(a){j(a)})})}function k(a,b,e,f,g){return a.runInTransaction(function(a){return c("LSOptimisticContributeToTextPromptStoredProcedure")(c("LSFactory")(a),{productAttribution:String(c("LSMessagingThreadAttributionType").ROLLCALL),promptId:(i||(i=d("I64"))).to_string(f),senderId:b,text:(a=g)!=null?a:"",threadKey:e})},"readwrite")}function l(a,b,e,f,g,j,k,l){var m,n=d("OfflineThreadingId").createOfflineThreadingID(),o=(m=l==null?void 0:l.startsWith("video/"))!=null?m:!1;return a.runInTransaction(function(a){return c("LSLocalApplyOptimisticMessageWithAttachmentsV2StoredProcedure")(c("LSFactory")(a),{extraSendMessageParams:d("LSShape").ofRecord({attachments:c("LSVec").ofArray([d("LSShape").ofRecord({attachment_fbid:n,attachment_index:(i||(i=d("I64"))).zero,attachment_type:(h||(h=d("LSIntEnum"))).ofNumber(o?c("MessagingAttachmentType").VIDEO:c("MessagingAttachmentType").IMAGE),has_media:!0,has_xma:!0,offline_attachment_id:n,playable_url:o?k:void 0,preview_height:i.of_float(d("MWXMAAttachmentSharedStackConstants").STACK_ITEM_HEIGHT),preview_url:o?void 0:k,preview_url_mime_type:o?void 0:l,preview_width:i.of_float(d("MWXMAAttachmentSharedStackConstants").STACK_ITEM_WIDTH)})]),contribution_type:h.ofNumber(c("RollCallContributionType").MEDIA),product_fbid:i.to_string(g),product_type:"roll_call",source:h.ofNumber(c("LSMessagingThreadAttributionType").ROLLCALL)}),senderId:b,text:j,threadKey:e,threadType:f})},"readwrite").then(function(a){a=a[0];return a})}function e(a,d,e,f,g,h,i,m,n){switch(i){case c("RollCallPromptType").MEDIA:return l(a,d,e,f,g,h,m,n);case c("RollCallPromptType").TEXT:return k(a,d,e,g,h);default:return(j||(j=b("Promise"))).reject()}}function f(a,b,e,f){var g=d("OfflineThreadingId").createOfflineThreadingID();a=a;a.uploadID=g;var h=new(c("XComposerPhotoUploader"))({onUploadFailure:function(a,b){},onUploadSuccess:function(a,b){},uploadEndpoint:"/messenger/upload_roll_call/"});h.getAsyncFileUploadRequest([a],[g],{data:{message_otid:e,roll_call_id:(i||(i=d("I64"))).to_string(b),thread_id:f}}).send()}g.createAuthoritiativeRollCall=a;g.createOptimisticRollCallMessage=e;g.startRollCallMediaUpload=f}),98);