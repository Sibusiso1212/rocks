;/*FB_PKG_DELIM*/

__d("LSLocalApplyOptimisticMessageWithAttachmentsV2",["LSArrayGetObjectAt","LSLocalApplyOptimisticMessageV2","LSLocalApplyOptimisticRollCallContribution","LSLocalApplyOptimisticSharedAlbumContribution","LSSetMessageDisplayedContentTypes"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.storedProcedure(b("LSLocalApplyOptimisticMessageV2"),a[0],a[1],a[2],a[3],a[4],a[5],void 0).then(function(a){return a=a,d[0]=a[0],d[1]=a[1],a})},function(e){return d[2]=a[5].get("attachments"),a[5],d[3]=a[5].get("product_type"),a[5],d[3]==="roll_call"?(d[4]=a[5].get("product_fbid"),a[5],d[5]=a[5].get("product_attribution"),a[5],d[6]=a[5].get("contribution_type"),a[5],c.storedProcedure(b("LSLocalApplyOptimisticRollCallContribution"),a[1],d[4],d[2],d[0],d[1],d[5],d[6],a[3])):d[3]==="shared_albums"?(d[4]=a[5].get("product_fbid"),a[5],d[5]=a[5].get("product_attribution"),a[5],c.storedProcedure(b("LSLocalApplyOptimisticSharedAlbumContribution"),a[1],d[4],d[2],d[0],d[1],d[5])):(d[4]=c.i64.of_int32(d[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[5]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[2],d[5]).then(function(a){return a=a,d[6]=a[0],d[7]=a[1],a})},function(b){return d[8]=d[6].get("attachment_fbid"),d[6],d[9]=d[6].get("offline_attachment_id"),d[6],d[10]=d[6].get("attachment_type"),d[6],d[11]=d[6].get("filename"),d[6],d[12]=d[6].get("filesize"),d[6],d[13]=d[6].get("attachment_index"),d[6],d[14]=d[6].get("has_media"),d[6],d[15]=d[6].get("has_xma"),d[6],d[16]=d[6].get("playable_url"),d[6],d[17]=d[6].get("playable_url_mime_type"),d[6],d[18]=d[6].get("playable_duration_ms"),d[6],d[19]=d[6].get("preview_url"),d[6],d[20]=d[6].get("preview_url_mime_type"),d[6],d[21]=d[6].get("mini_preview"),d[6],d[22]=d[6].get("preview_width"),d[6],d[23]=d[6].get("preview_height"),d[6],d[24]=d[6].get("xma_layout_type"),d[6],d[25]=d[6].get("xmas_template_type"),d[6],d[26]=d[6].get("cta1_title"),d[6],d[27]=d[6].get("cta2_title"),d[6],d[28]=d[6].get("cta3_title"),d[6],d[29]=d[6].get("image_url"),d[6],d[30]=d[6].get("action_url"),d[6],d[31]=d[6].get("title_text"),d[6],d[32]=d[6].get("subtitle_text"),d[6],d[33]=d[6].get("description_text"),d[6],d[34]=d[6].get("source_text"),d[6],d[35]=d[6].get("original_file_hash"),d[6],d[36]=d[6].get("sound_bite_client_sound_key"),d[6],d[37]=d[6].get("sound_bite_visual"),d[6],d[38]=d[6].get("ephemeral_media_state"),d[6],d[39]=d[6].get("waveform_data"),d[6],d[40]=d[6].get("avatar_audio_message_animated_url"),d[6],d[41]=d[6].get("avatar_audio_message_idle_url"),d[6],d[42]=d[6].get("avatar_audio_message_animated_b_url"),d[6],d[43]=d[6].get("avatar_audio_message_idle_b_url"),d[6],d[44]=d[6].get("avatar_audio_message_background_graphics_image_url"),d[6],d[45]=d[6].get("avatar_audio_message_pose_id"),d[6],d[46]=d[6].get("sampling_frequency_hz"),d[6],d[47]=d[6].get("should_autoplay_video"),d[6],c.filter(c.db.table(16).fetch([[[a[1],d[0],d[8]]]]),function(b){return c.i64.eq(b.threadKey,a[1])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&b.messageId===d[0]&&b.attachmentFbid===d[8]&&c.i64.gt(b.authorityLevel,c.i64.cast([0,20]))}).next().then(function(b){var e=b.done;b.value;return e?c.db.table(16).put({threadKey:a[1],messageId:d[0],attachmentFbid:d[8],timestampMs:d[1],offlineAttachmentId:d[9],attachmentType:d[10],filename:d[11],filesize:d[12],attachmentIndex:d[13],hasMedia:d[14],hasXma:d[15],isSharable:!1,playableUrl:d[16],playableUrlMimeType:d[17],playableDurationMs:d[18],previewUrl:d[19],previewUrlMimeType:d[20],miniPreview:d[21],previewWidth:d[22],previewHeight:d[23],xmaLayoutType:d[24],xmasTemplateType:d[25],cta1Title:d[26],cta2Title:d[27],cta3Title:d[28],imageUrl:d[29],actionUrl:d[30],titleText:d[31],subtitleText:d[32],descriptionText:d[33],sourceText:d[34],ephemeralMediaState:d[38],waveformData:d[39],samplingFrequencyHz:d[46],originalFileHash:d[35],authorityLevel:c.i64.cast([0,20]),shouldAutoplayVideo:d[47]}):0})}])}):c.resolve())},function(e){return d[4]=c.i64.of_int32(d[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?(d[5]=a[5].get("sticker_id"),a[5],c.storedProcedure(b("LSSetMessageDisplayedContentTypes"),a[1],d[0],d[1],a[3],!1,c.i64.neq(d[5],void 0))):c.resolve()},function(a){return a=[d[0],d[1]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);