;/*FB_PKG_DELIM*/

__d("IGDAWAdminWriteMsgTxn",["I64","LSAuthorityLevel","LSIntEnum","LSMessageSendStatus","LSMessageUnsendabilityStatus","WAGlobals","WAJids","asyncToGeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e,f=c("uuidv4")(),g="admin:"+(h||(h=d("I64"))).to_string(b.threadKey)+":"+f;e=(e=b.timestampMs)!=null?e:(h||(h=d("I64"))).of_float(Date.now());yield a.messages.put({adminMsgCtaType:b.ctaType,authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE),cannotUnsendReason:i.ofNumber(c("LSMessageUnsendabilityStatus").DENY_LOG_MESSAGE),displayedContentTypes:i.ofNumber(32),isAdminMessage:!0,messageId:g,offlineThreadingId:f,primarySortKey:e,secondarySortKey:void 0,senderId:(a=b.senderId)!=null?a:(h||(h=d("I64"))).of_string(d("WAJids").extractUserId(d("WAGlobals").getMyUserJid())),sendStatus:i.ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED),sendStatusV2:i.ofNumber(2),text:b.text,threadKey:b.threadKey,timestampMs:e,transportKey:"FBBroker"})});return j.apply(this,arguments)}g.writeAdminMessageTxn=a}),98);
__d("IGDThreadTTLCUtils",["FBLogger","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=h(a);return Boolean(a==null?void 0:(a=a.ttlc_message_type)==null?void 0:a.is_ttlc_enabled)}function b(a,b){a=h(a);return Boolean(a==null?void 0:(a=a.ttlc_message_type)==null?void 0:(a=a.enabled_ttlc_message_type)==null?void 0:a[b])}function h(a){var b=c("qex")._("954");if(!Boolean(b))return null;if(a==null)return null;try{return JSON.parse(a)}catch(a){c("FBLogger")("igd_web_on_msgr").mustfix("Failed to parse thread metadata, the error is %s.",a)}return null}g.isIGDTTLCEnabled=a;g.isIGDTTLCEnabledForMessageType=b}),98);
__d("IGDDisappearingMessagesStrings",["fbt"],(function(a,b,c,d,e,f,g,h){"use strict";a="https://help.instagram.com/491565145294150/";b=h._("__JHASH__2OBcaB7QAZn__JHASH__");g.LEARN_MORE_LINK=a;g.DM_SECURITY_NOTICE=b}),226);
__d("IGDDMModeContextProvider",["DisappearingMessagesMode","FBLogger","I64","IGDAWAdminWriteMsgTxn","IGDDisappearingMessagesStrings","IGDInstamadilloUtils","Int64Hooks","LSMessagingThreadTypeUtil","MAWEphemeralConsts","MWLSThread","MWPActor.react","MessengerWebUXLogger","PolarisDirectAPI","PolarisDismissEntry","ReQL","ReQLSuspense","asyncToGeneratorRuntime","promiseDone","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||(j=d("react"));e=j;var l=e.createContext,m=e.useCallback,n=e.useEffect,o=e.useMemo,p=e.useState,q=l({dmMode:c("DisappearingMessagesMode").OFF,lastSetTtlSec:d("MAWEphemeralConsts").oneDayInSeconds,setLastSetTtlSec:function(){},toggleDMMode:function(){}});function r(a){var b=p(a),c=b[0],d=b[1];b=p(a);var e=b[0];b=b[1];e!==a&&(b(a),d(a));e=m(function(){c!==a&&d(a)},[a,c]);return[c,d,e]}function a(a){var e=a.children,g=a.threadKey,j=(h||(h=c("useReStore")))(),l=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(j.tables.ig_thread_info,["igDmSettingsMode","igThreadId","igDmSettingsLastSetActorId","igDmSettingsLastSetTimestampMs","igDmSettingsTtlSec"]).getKeyRange(g).map(function(a){var b=a.igDmSettingsLastSetActorId,c=a.igDmSettingsLastSetTimestampMs,d=a.igDmSettingsMode,e=a.igDmSettingsTtlSec;a=a.igThreadId;return{authoritativeDMMode:d,igDmSettingsLastSetActorId:b,igDmSettingsLastSetTimestampMs:c,igDmSettingsTtlSec:e,igThreadId:a}})},[j,g],f.id+":90"),m=o(function(){return(l==null?void 0:l.authoritativeDMMode)!=null&&(i||(i=d("I64"))).to_int32(l==null?void 0:l.authoritativeDMMode)===c("DisappearingMessagesMode").ON?c("DisappearingMessagesMode").ON:c("DisappearingMessagesMode").OFF},[l]),p=o(function(){return(l==null?void 0:l.igDmSettingsTtlSec)!=null?(i||(i=d("I64"))).to_float(l==null?void 0:l.igDmSettingsTtlSec):d("MAWEphemeralConsts").oneDayInSeconds},[l]);a=o(function(){return(l==null?void 0:l.igDmSettingsLastSetTimestampMs)!=null?(i||(i=d("I64"))).to_float(l==null?void 0:l.igDmSettingsLastSetTimestampMs):void 0},[l]);var s=r(m),t=s[0],u=s[1],v=s[2];s=r(p);var w=s[0],x=s[1],y=s[2];s=r(a);var z=s[0],A=s[1],B=s[2];a=r(l==null?void 0:l.igDmSettingsLastSetActorId);var C=a[0],D=a[1],E=a[2],F=d("MWPActor.react").useActor(),G=c("MessengerWebUXLogger").useInteractionLogger(),H=d("Int64Hooks").useCallbackInt64(function(){var a=t===c("DisappearingMessagesMode").ON?c("DisappearingMessagesMode").OFF:c("DisappearingMessagesMode").ON;u(a);A(new Date().getTime());D(F);(l==null?void 0:l.igThreadId)!=null&&c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield d("PolarisDirectAPI").setDisappearingMessagesSettings(l==null?void 0:l.igThreadId,a,w));b.statusCode!==200&&(c("FBLogger")("igd_web_on_msgr").warn("Toggle DM Network Request failed",b.toString()),v(),B(),E())}catch(a){c("FBLogger")("igd_web_on_msgr").warn("Toggle DM Network Request failed",a.toString()),v(),B(),E()}return})());c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("MWLSThread").getThreadAsync(j,g));if(a){var b=d("IGDInstamadilloUtils").isInstamadilloCutover(a),e=d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(a);a=a?d("LSMessagingThreadTypeUtil").isSecure(a.threadType):!1;G==null?void 0:G({eventName:t===c("DisappearingMessagesMode").ON?"direct_disappearing_messages_toggle_off":"direct_disappearing_messages_toggle_on",extraData:{dm_duration:String(w),is_instamadillo:String(e),is_instamadillo_tlc:String(b),is_secure:String(a)}})}})())},[F,j,t,w,G,v,E,B,u,D,A,l==null?void 0:l.igThreadId,g]),I=d("Int64Hooks").useCallbackInt64(function(a){var e;if(a===p)return;x(a);A(new Date().getTime());D(F);e=(e=l)!=null?e:{};var f=e.authoritativeDMMode,h=e.igThreadId;h!=null&&f!=null&&c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield d("PolarisDirectAPI").setDisappearingMessagesSettings(h,t,a));b.statusCode!==200&&(c("FBLogger")("ig_web").warn("DM TTL Network Request failed",b.toString()),y(),B(),E())}catch(a){c("FBLogger")("ig_web").warn("DM TTL Network Request failed",a.toString()),y(),B(),E()}return})());c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("MWLSThread").getThreadAsync(j,g));if(b){var c=d("IGDInstamadilloUtils").isInstamadilloCutover(b),e=d("IGDInstamadilloUtils").isInstamadilloTransportEnabled(b);b=b?d("LSMessagingThreadTypeUtil").isSecure(b.threadType):!1;G==null?void 0:G({eventName:"direct_disappearing_messages_ttl_changed",extraData:{is_instamadillo:String(e),is_instamadillo_tlc:String(c),is_secure:String(b),new_dm_duration:String(a),old_dm_duration:String(w)}})}})())},[j,w,G,F,t,E,B,y,D,A,x,l,g,p]);n(function(){m===c("DisappearingMessagesMode").ON&&!d("PolarisDismissEntry").isInstamadilloNuxDismissed(d("PolarisDismissEntry").IGD_INSTAMADILLO_DM_FIRST_TIME_ADMIN_MESSAGE_TYPE)&&(d("PolarisDismissEntry").setInstamadilloNuxSessionTimes(d("PolarisDismissEntry").IGD_INSTAMADILLO_DM_FIRST_TIME_ADMIN_MESSAGE_TYPE),c("promiseDone")(j.runInTransaction(function(a){return d("IGDAWAdminWriteMsgTxn").writeAdminMessageTxn(a,{ctaType:"admin_msg_ig_dm_learn_more",senderId:F,text:d("IGDDisappearingMessagesStrings").DM_SECURITY_NOTICE.toString(),threadKey:g,timestampMs:l==null?void 0:l.igDmSettingsLastSetTimestampMs})},"readwrite")))},[m,F,j,l==null?void 0:l.igDmSettingsLastSetTimestampMs,g]);s=o(function(){return{dmMode:t,lastSetActorId:C,lastSetTimestampMs:z,lastSetTtlSec:w,setLastSetTtlSec:I,toggleDMMode:H}},[t,C,z,w,I,H]);return k.jsx(q.Provider,{value:s,children:e})}a.displayName=a.name+" [from "+f.id+"]";g.IGDDMModeContext=q;g.IGDDMModeContextProvider=a}),98);
__d("IGDThreadTTLCContext.react",["IGDThreadTTLCUtils","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));c=h;var j=c.useContext;c.useMemo;var k=c.unstable_useMemoCache,l=i.createContext(!1);function a(a){var b=k(5),c=a.children;a=a.thread;var e;b[0]!==a.metadata?(e=d("IGDThreadTTLCUtils").isIGDTTLCEnabled(a.metadata),b[0]=a.metadata,b[1]=e):e=b[1];a=e;e=a;b[2]!==e||b[3]!==c?(a=i.jsx(l.Provider,{value:e,children:c}),b[2]=e,b[3]=c,b[4]=a):a=b[4];return a}function b(){return j(l)}g.IGDThreadTTLCContextProvider=a;g.useIsIGDTTLCEnabled=b}),98);
__d("useGetPluginType",["DisappearingMessagesMode","IGDDMModeContextProvider","IGDThreadTTLCContext.react","LSIntEnum","LSPendingTasksPluginType","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=h||d("react");var j=b.useContext,k=b.unstable_useMemoCache;function l(a,b,e){return e?(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):a&&b!=null?b===c("DisappearingMessagesMode").ON?(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").EPHEMERAL_MESSAGING):(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").IGD_INSTAMADILLO):void 0}function a(a){var b=k(4),c=j(d("IGDDMModeContextProvider").IGDDMModeContext);c=c.dmMode;var e=d("IGDThreadTTLCContext.react").useIsIGDTTLCEnabled(),f;b[0]!==a||b[1]!==c||b[2]!==e?(f=l(a,c,e),b[0]=a,b[1]=c,b[2]=e,b[3]=f):f=b[3];return f}g["default"]=a}),98);
__d("cometIsMimeTypeForMedia",["FBLogger","UFICommentFileInputAcceptValues"],(function(a,b,c,d,e,f,g){"use strict";var h={file:null,photo:null,video:null},i={"image/gif":"video","image/webp":"video"};function j(a){return a.split(",").map(function(a){return a.trim()}).map(function(a){return a.replace(/\/\*$/,"/")})}function k(a,b,d){h[a]==null&&(h[a]=j(d));d=h[a];if(d==null)throw c("FBLogger")("ufi2").mustfixThrow("CometIsMimeTypeForMedia prefixes can't be null");var e=i[b];return e!=null?e===a:d.some(function(a){return b.startsWith(a)})}function a(a){return k("photo",a,d("UFICommentFileInputAcceptValues").photos)}function b(a){return k("video",a,d("UFICommentFileInputAcceptValues").videos)}function e(a){return k("file",a,d("UFICommentFileInputAcceptValues").files)}g.mimeTypeAcceptStringToArray=j;g.isMimeTypeForPhoto=a;g.isMimeTypeForVideo=b;g.isMimeTypeForFile=e}),98);
__d("LSGetAttachmentType",["LSIntEnum","MessagingAttachmentType","cometIsMimeTypeForMedia"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=a.type;if(d("cometIsMimeTypeForMedia").isMimeTypeForPhoto(a))return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE);else if(a==="audio/wav")return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO);else if(a==="image/gif")return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").ANIMATED_IMAGE);else if(d("cometIsMimeTypeForMedia").isMimeTypeForVideo(a))return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO);else return(h||(h=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").FILE)}g["default"]=a}),98);
__d("LSIssueNewTaskWithExtraOperations",["LSIssueNewTaskAndGetTaskID","LSMailboxTaskCompletionApiOnTaskInsertion"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[11]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskInsertion"),d[0])}])},function(a){return c.resolve(e)}])}e.exports=a}),null);